@model ElGradebook

<h2>Электронный журнал</h2>

<table class="table table-hover">
    <tr>
        <th>ФИО студента</th>
        @foreach (var lesson in Model.ElGradebookLessons)
        {
            <th>
                @lesson.Date.ToShortDateString()
                <a asp-action="ElGradebookLessonMarksEdit"
                   asp-route-elGradebookLessonId="@lesson.ElGradebookLessonId"
                   target="_blank">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </a>
            </th>
        }
        <th>Сумма</th>
    </tr>

    @foreach (var student in Model.ElGradebookGroupStudents)
    {
        <tr>
            <td>
                @if (!string.IsNullOrEmpty(student.AppUserId))
                {
                    <a asp-controller="UserProfile"
                       asp-action="Index"
                       asp-route-id="@student.AppUserId"
                       target="_blank">@student.ElGradebookGroupStudentFio</a>
                }
                else
                {
                    @student.ElGradebookGroupStudentFio
                }
            </td>

            @{ 
                int studentMarksSum = 0;
                foreach (var lesson in Model.ElGradebookLessons)
                {
                <td>
                    @{
                        var lessonMark = lesson.ElGradebookLessonMarks.FirstOrDefault(m=>m.ElGradebookGroupStudentId == student.ElGradebookGroupStudentId);
                        if(lessonMark != null)
                        {
                            if(lessonMark.ElGradebookLessonAttendanceTypeId != 1)
                            {
                                <text>@lessonMark.ElGradebookLessonAttendanceType.ElGradebookLessonAttendanceTypeName</text>
                            }
                            else
                            {
                                studentMarksSum += lessonMark.PointsNumber;
                                <text>@lessonMark.PointsNumber</text>                                
                            }
                        }
                    }
                </td>
            }
            }

            <td>
                @studentMarksSum
            </td>
        </tr>
     }
</table>
